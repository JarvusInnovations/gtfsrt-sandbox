version: 2

models:
  - name: stg_vehicle_positions
    description: >
      Staging model for GTFS-RT vehicle positions. Each row represents a
      vehicle position update from the feed. Reads pre-downloaded parquet
      data from the local data/ directory.

      Before running: uv run python scripts/download_data.py --defaults
    columns:
      - name: partition_date
        description: Date partition from the data source
      - name: feed_base64
        description: Base64url-encoded feed URL (from Hive partitioning)
      - name: feed_url
        description: Original feed URL
      - name: feed_timestamp
        description: Timestamp when the feed was fetched
      - name: entity_id
        description: Unique identifier for this entity in the feed
      - name: vehicle_id
        description: Transit agency's vehicle identifier
      - name: trip_id
        description: Trip identifier from GTFS static
      - name: route_id
        description: Route identifier from GTFS static
      - name: latitude
        description: Vehicle latitude (WGS84)
      - name: longitude
        description: Vehicle longitude (WGS84)
      - name: speed
        description: Vehicle speed in meters per second
      - &_uuid
        name: _uuid
        description: '{{ doc("uuid") }}'

  - name: stg_trip_updates
    description: >
      Staging model for GTFS-RT trip updates. Denormalized with one row
      per stop_time_update within each trip update entity. Reads pre-downloaded
      parquet data from the local data/ directory.

      Before running: uv run python scripts/download_data.py --defaults
    columns:
      - name: partition_date
        description: Date partition from the data source
      - name: feed_base64
        description: Base64url-encoded feed URL (from Hive partitioning)
      - name: feed_url
        description: Original feed URL
      - name: feed_timestamp
        description: Timestamp when the feed was fetched
      - name: entity_id
        description: Unique identifier for this entity in the feed
      - name: trip_id
        description: Trip identifier from GTFS static
      - name: stop_id
        description: Stop identifier from GTFS static
      - name: arrival_delay
        description: Delay in seconds (positive = late, negative = early)
      - name: departure_delay
        description: Delay in seconds (positive = late, negative = early)
      - *_uuid

  - name: stg_service_alerts
    description: >
      Staging model for GTFS-RT service alerts. Denormalized with one row
      per informed_entity within each alert. Reads pre-downloaded parquet
      data from the local data/ directory.

      Before running: uv run python scripts/download_data.py --defaults
    columns:
      - name: partition_date
        description: Date partition from the data source
      - name: feed_base64
        description: Base64url-encoded feed URL (from Hive partitioning)
      - name: feed_url
        description: Original feed URL
      - name: feed_timestamp
        description: Timestamp when the feed was fetched
      - name: entity_id
        description: Unique identifier for this entity in the feed
      - name: header_text
        description: Alert header/title text
      - name: description_text
        description: Alert description text
      - name: cause
        description: Alert cause code
      - name: effect
        description: Alert effect code
      - *_uuid

  - name: stg_available_feeds
    description: >
      Feed inventory from parquet.gtfsrt.io. Lists all available GTFS-RT
      feeds with metadata including agency info, feed type, date range,
      and size statistics. Reads directly from remote JSON.
    columns:
      - name: feed_url
        description: Original GTFS-RT feed URL
      - name: feed_base64
        description: Base64url-encoded feed URL (used in parquet file paths)
      - name: agency_id
        description: Transit agency identifier (e.g., "septa", "actransit")
      - name: agency_name
        description: Transit agency display name
      - name: feed_type
        description: Feed type - service_alerts, trip_updates, or vehicle_positions
      - name: date_min
        description: Earliest date with data available
      - name: date_max
        description: Latest date with data available
      - name: total_records
        description: Total number of records across all dates
      - name: total_bytes
        description: Total size of all parquet files in bytes
      - name: days_available
        description: Number of days with data (computed)
      - name: avg_bytes_per_day
        description: Average bytes per day (computed)
